<canvas id="canvas"></canvas>
<script>
    var c=document.getElementById("canvas");
    var ctx=c.getContext("2d");
    ctx.canvas.width=window.innerWidth-20;
    ctx.canvas.height=window.innerHeight-20;
    var canvas_x=ctx.canvas.width;
    var canvas_y=ctx.canvas.height;

    function vectorsofobjects(a){
        var allvectors=[];
        for(var i=0;i<a.length;i++){
            var objectvectors=[];
            for(var k=0;k<a[i][1].length;k++){
                var p1=a[i][0][a[i][1][k][0]];
                var p2=a[i][0][a[i][1][k][1]];
                var p3=a[i][0][a[i][1][k][2]];
                var v1=[p2[0]-p1[0],p2[1]-p1[1],p2[2]-p1[2]];
                var v2=[p3[0]-p1[0],p3[1]-p1[1],p3[2]-p1[2]];
                var crossproductvector=[v1[1]*v2[2]-v1[2]*v2[1],v1[2]*v2[0]-v1[0]*v2[2],v1[0]*v2[1]-v1[1]*v2[0]];
                // v1,v2,crossproductvector
                objectvectors.push([v1,v2,crossproductvector]);
            }
            allvectors.push(objectvectors);
        }
        return allvectors;
    }
    function positionsoncamerasurface(objs,pxrtio,cameraobj){
        var allpoints=[];
        for(var i=0;i<objs.length;i++){
            var pts=[];
            for(var k=0;k<objs[i][0].length;k++){
                var vA=[objs[i][0][k][0]-cameraobj[0][0],objs[i][0][k][1]-cameraobj[0][1],objs[i][0][k][2]-cameraobj[0][2]];
                var t=(cameraobj[1][0]**2+cameraobj[1][1]**2+cameraobj[1][2]**2)/(vA[0]*cameraobj[1][0]+vA[1]*cameraobj[1][1]+vA[2]*cameraobj[1][2]);
                if(t>0){
                    var vB=[vA[0]*t-cameraobj[1][0],vA[1]*t-cameraobj[1][1],vA[2]*t-cameraobj[1][2]];
                    var n1c=cameraobj[2][0]*vB[0]+cameraobj[2][1]*vB[1]+cameraobj[2][2]*vB[2];
                    var n2c=cameraobj[3][0]*vB[0]+cameraobj[3][1]*vB[1]+cameraobj[3][2]*vB[2];
                    pts.push([n1c*pxrtio+canvas_x/2,canvas_y/2-n2c*pxrtio]);
                }
                else{
                    pts.push(false);
                }
            }
            allpoints.push(pts);
        }
        return allpoints;
    }   
    // (rotation_point, object_point, rotation_vector, object_vectors, rotation_angle)
    function generalrotation(p0,p1,v1,vectors,theta){
        var rad=Math.PI/180;
        var lv1=(v1[0]**2+v1[1]**2+v1[2]**2)**0.5;
        if(p0[0]!=p1[0] || p0[1]!=p1[1] || p0[2]!=p1[2]){
            var t=(v1[0]*(p1[0]-p0[0])+v1[1]*(p1[1]-p0[1])+v1[2]*(p1[2]-p0[2]))/(v1[0]**2+v1[1]**2+v1[2]**2);
            var p3=[p0[0]+v1[0]*t,p0[1]+v1[1]*t,p0[2]+v1[2]*t];
            var v2=[p1[0]-p3[0],p1[1]-p3[1],p1[2]-p3[2]];
            var crossv1=[v1[1]*v2[2]-v1[2]*v2[1],v1[2]*v2[0]-v1[0]*v2[2],v1[0]*v2[1]-v1[1]*v2[0]];
            var lv2=(v2[0]**2+v2[1]**2+v2[2]**2)**0.5;
            var lcross1=(crossv1[0]**2+crossv1[1]**2+crossv1[2]**2)**0.5;
            if(lv2!=0 && lcross1!=0){
                var new_pos=[Math.cos(theta*rad)*v2[0]+Math.sin(theta*rad)*lv2/lcross1*crossv1[0]+p3[0],Math.cos(theta*rad)*v2[1]+Math.sin(theta*rad)*lv2/lcross1*crossv1[1]+p3[1],Math.cos(theta*rad)*v2[2]+Math.sin(theta*rad)*lv2/lcross1*crossv1[2]+p3[2]];
            }
            else{
                var new_pos=p1;
            }
        }
        else{
            var new_pos=p1;
        }
        var new_vectors=[];
        new_vectors.push(new_pos);
        for(var i=0;i<vectors.length;i++){
            var parallelveclen=(v1[0]*vectors[i][0]+v1[1]*vectors[i][1]+v1[2]*vectors[i][2])/lv1;
            var subvec=[vectors[i][0]-parallelveclen*v1[0]/lv1,vectors[i][1]-parallelveclen*v1[1]/lv1,vectors[i][2]-parallelveclen*v1[2]/lv1];
            var lsv=(subvec[0]**2+subvec[1]**2+subvec[2]**2)**0.5;
            var crossv2=[v1[1]*subvec[2]-v1[2]*subvec[1],v1[2]*subvec[0]-v1[0]*subvec[2],v1[0]*subvec[1]-v1[1]*subvec[0]];
            var lcross2=(crossv2[0]**2+crossv2[1]**2+crossv2[2]**2)**0.5;
            if(lsv!=0 && lcross2!=0){
                var new_v=[Math.cos(theta*rad)*subvec[0]+Math.sin(theta*rad)*lsv/lcross2*crossv2[0]+parallelveclen*v1[0]/lv1,Math.cos(theta*rad)*subvec[1]+Math.sin(theta*rad)*lsv/lcross2*crossv2[1]+parallelveclen*v1[1]/lv1,Math.cos(theta*rad)*subvec[2]+Math.sin(theta*rad)*lsv/lcross2*crossv2[2]+parallelveclen*v1[2]/lv1];
            }
            else{
                new_v=vectors[i];
            }
            new_vectors.push(new_v);
        }
        return new_vectors;
    }
    function colorofmesh(maincolor,normalvector,camerapos,centerofmesh){
        var v1=[centerofmesh[0]-camerapos[0],centerofmesh[1]-camerapos[1],centerofmesh[2]-camerapos[2]];
        var v1len=(v1[0]**2+v1[1]**2+v1[2]**2)**0.5;
        var normallen=(normalvector[0]**2+normalvector[1]**2+normalvector[2]**2)**0.5;
        var cosvalue=Math.abs((v1[0]*normalvector[0]+v1[1]*normalvector[1]+v1[2]*normalvector[2])/(normallen*v1len));
        return [(1+cosvalue)*maincolor[0]/2*1.2,(1+cosvalue)*maincolor[1]/2*1.2,(1+cosvalue)*maincolor[2]/2*1.2];
    }
    function priority(objs,campos,objvecs){
        var distances=[];
        var meshindexes=[];
        var vecs=[];
        var drawing=false;
        var order=[];
        for(var k=0;k<objs.length;k++){
            for(var j=0;j<objs[k][1].length;j++){
                var p0=objs[k][0][objs[k][1][j][0]];
                var p1=objs[k][0][objs[k][1][j][1]];
                var p2=objs[k][0][objs[k][1][j][2]];
                var averageX=(p0[0]+p1[0]+p2[0])/3;
                var averageY=(p0[1]+p1[1]+p2[1])/3;
                var averageZ=(p0[2]+p1[2]+p2[2])/3;
                distances.push(((averageX-campos[0])**2+(averageY-campos[1])**2+(averageZ-campos[2])**2)**0.5);
                meshindexes.push([k,j]);
                vecs.push([averageX-campos[0],averageY-campos[1],averageZ-campos[2]]);
            }
        }
        while(distances.length>0){
            drawing=true;
            var index=distances.indexOf(Math.max(...distances));
            var V=vecs[index];
            for(var h=0;h<objvecs.length;h++){
                for(var k=0;k<objvecs[h].length;k++){
                    if(meshindexes[index][0]==h && meshindexes[index][1]!=k){
                        var v1=objvecs[h][k][0];
                        var v2=objvecs[h][k][1];
                        var det=-V[0]*v1[1]*v2[2]-V[1]*v2[0]*v1[2]-V[2]*v1[0]*v2[1]+V[0]*v2[1]*v1[2]+V[1]*v1[0]*v2[2]+V[2]*v2[0]*v1[1];
                        if(det!=0){
                            var p0=objs[h][0][objs[h][1][k][0]];
                            var b=[campos[0]-p0[0],campos[1]-p0[1],campos[2]-p0[2]];
                            var invmatrix=[[-v2[1]*V[2]+v2[2]*V[1],-v2[2]*V[0]+v2[0]*V[2],-v2[0]*V[1]+v2[1]*V[0]],[-v1[2]*V[1]+v1[1]*V[2],-v1[0]*V[2]+v1[2]*V[0],-v1[1]*V[0]+v1[0]*V[1]],[v1[1]*v2[2]-v1[2]*v2[1],v1[2]*v2[0]-v1[0]*v2[2],v1[0]*v2[1]-v1[1]*v2[0]]];
                            var results=[(invmatrix[0][0]*b[0]+invmatrix[0][1]*b[1]+invmatrix[0][2]*b[2])/det,(invmatrix[1][0]*b[0]+invmatrix[1][1]*b[1]+invmatrix[1][2]*b[2])/det,(invmatrix[2][0]*b[0]+invmatrix[2][1]*b[1]+invmatrix[2][2]*b[2])/det];
                            if(0.2<=results[0] && results[0]<=0.8 && 0<=results[1] && results[1]<=1-results[0] && 0.2<results[2] && results[2]<0.8){
                                drawing=false;
                                break;
                            }
                        }
                    }
                }
                if(drawing==false){
                    break;
                }
            }
            if(drawing){
                order.push(meshindexes[index]);
            }
            meshindexes.splice(index,1);
            distances.splice(index,1);
            vecs.splice(index,1);
        }
        return order;
    }   
    function outline(points){
        var p=[];
        var dotproducts=[];
        var ypoints=[];
        var pointsinorder=[];
        for(i=0;i<points.length;i++){
            ypoints.push(points[i][1]);
        }
        var y0=Math.min(...ypoints);
        for(i=0;i<points.length;i++){
            if(points[i][1]==y0){
                x0=points[i][0];
            }
        }
        p.push([x0,y0]);
        for(k=0;k<points.length;k++){
            if(points[k][0]!=p[0][0] || points[k][1]!=p[0][1]){
                len1=((p[0][0]-points[k][0])**2+(p[0][1]-points[k][1])**2)**0.5;
                dotproducts.push(Math.abs((points[k][0]-p[0][0])/len1));
                pointsinorder.push(points[k]);
            }
        }
        p.push(pointsinorder[dotproducts.indexOf(Math.max(...dotproducts))]);
        if(!isNaN(p[0][1]) && !isNaN(p[0][0])){
            while(p[0][0]!=p[p.length-1][0] || p[0][1]!=p[p.length-1][1]){
                dotproducts=[];
                pointsinorder=[];
                len=p.length;
                len1=((p[len-1][0]-p[len-2][0])**2+(p[len-1][1]-p[len-2][1])**2)**0.5;
                v=[(p[len-1][0]-p[len-2][0])/len1,(p[len-1][1]-p[len-2][1])/len1];
                for(var k=0;k<points.length;k++){
                    if((points[k][0]!=p[len-1][0] || points[k][1]!=p[len-1][1]) && (points[k][0]!=p[len-2][0] || points[k][1]!=p[len-2][1])){
                        len1=((p[len-1][0]-points[k][0])**2+(p[len-1][1]-points[k][1])**2)**0.5;
                        dotproducts.push(((points[k][0]-p[len-1][0])*v[0]+(points[k][1]-p[len-1][1])*v[1])/len1);
                        pointsinorder.push(points[k]);
                    }
                }
                p.push(pointsinorder[dotproducts.indexOf(Math.max(...dotproducts))]);
            }
            return p;
        }
        else{
            return [];
        }
    }
    function averageobjdistances(objs,campos){
        var distances=[];
        var indexes=[];
        var order=[];
        for(var h=0;h<objs.length;h++){
            var totalx=0;
            var totaly=0;
            var totalz=0;
            for(var i=0;i<objs[h][0].length;i++){
                totalx+=objs[h][0][i][0];
                totaly+=objs[h][0][i][1];
                totalz+=objs[h][0][i][2];
            }
            distances.push(((totalx/i-campos[0])**2+(totaly/i-campos[1])**2+(totalz/i-campos[2])**2)**0.5);
            indexes.push(h);
        }
        while(distances.length>0){
            var ind=distances.indexOf(Math.min(...distances));
            order.push(indexes[ind]);
            distances.splice(ind,1);
            indexes.splice(ind,1);
        }
        return order;
    }
    function selectioncontrol(outlinepoints,x,y,distanceorder){
        for(var h=0;h<distanceorder.length;h++){
            var count=0;
            var index=distanceorder[h];
            for(var i=0;i<outlinepoints[index].length-1;i++){
                if(outlinepoints[index][i][1]!=outlinepoints[index][i+1][1]){
                    var t=(y-outlinepoints[index][i][1])/(outlinepoints[index][i+1][1]-outlinepoints[index][i][1]);
                    var k=outlinepoints[index][i][0]+(outlinepoints[index][i+1][0]-outlinepoints[index][i][0])*t-x;
                    if(k>=0 && t>=0 && t<=1){
                        count++;
                    }
                }
            }
            if(count%2==1){
                return index;
            }
        }
        return -1;
    }
    // [[object1],[object2],...] --object1> [[points],[meshes]] --meshes> [index1,index2,index3,color]
    var objects=[[[[0, 7.146872, 0], [0, -1.039432, 0], [0.017468, 7.100203, -0.309436], [-0.233, 7.100203, -0.202], [-0.300251, 7.100203, 0.03964], [-0.180955, 7.100203, 0.241717], [0, 7.100203, 0.316671], [0.231134, 7.100203, 0.206505], [0.312083, 7.100203, -0.011077], [0.206453, 7.100203, -0.231155], [-0.207466, 7.100203, -0.230736], [-1.081176, 9.80649, -1.324126], [-0.016454, 7.100203, -0.309856], [-0.230523, 9.80649, -1.676477], [0.309458, 7.100203, 0.017415], [0.228508, 7.100203, -0.212843], [1.458628, 10.155724, 0.107689], [1.328199, 10.181355, -1.04812], [0.183517, 10.10704, -2.056776], [-1.031265, 10.672251, -0.832519], [-1.471759, 10.187764, 0.140042], [-1.158455, 10.200579, 1.389134], [0.232794, 10.226212, 1.766688], [1.106276, 10.155724, 0.958341], [1.680551, 10.181355, -0.197467], [1.03417, 10.10704, -1.704424], [-1.383617, 10.672251, 0.018133], [-0.307591, 7.100203, -0.02192], [-1.119407, 10.187764, 0.990694], [-0.240339, 7.100203, 0.18428], [-0.307802, 10.200579, 1.741486], [-0.042965, 7.100203, 0.298874], [1.083447, 10.226212, 1.414335], [0.22392, 7.100203, 0.22392], [0.7008, 8.640779, -0.064796], [0.541358, 8.640779, -0.449723], [0.449723, 8.640779, -0.541358], [0.064796, 8.640779, -0.7008], [-0.064796, 8.640779, -0.7008], [-0.449723, 8.640779, -0.541358], [-0.541358, 8.640779, -0.449723], [-0.7008, 8.640779, -0.064796], [-0.7008, 8.640779, 0.064796], [-0.541358, 8.640779, 0.449723], [-0.449723, 8.640779, 0.541358], [-0.064796, 8.640779, 0.7008], [0.064796, 8.640779, 0.7008], [0.449723, 8.640779, 0.541358], [0.541358, 8.640779, 0.449723], [0.7008, 8.640779, 0.064796], [-0.173852, 7.144691, -0.149443], [0.01716, 7.144691, -0.228563], [-0.219686, 7.125962, 0.014504], [-0.145094, 7.125962, -0.165577], [-0.154627, 7.133547, 0.148796], [-0.214539, 7.133547, 0.004156], [-0.008592, 7.140357, 0.215665], [-0.146581, 7.140357, 0.158508], [0.189386, 7.139878, 0.140548], [-0.034534, 7.139878, 0.233299], [0.223672, 7.133307, -0.018118], [0.145348, 7.133307, 0.170973], [0.14461, 7.138556, -0.178091], [0.228185, 7.138556, 0.023675], [-0.016126, 7.146142, -0.228945], [0.172859, 7.146142, -0.150665], [-0.416108, 8.685267, -0.460066], [-0.196909, 9.850979, -1.595185], [-0.031182, 8.685268, -0.619508], [0.031203, 8.686718, -0.620309], [0.41613, 8.686718, -0.460868], [0.149924, 10.152979, -1.976285], [1.000577, 10.152979, -1.623934], [0.45746, 8.679132, -0.414971], [0.616902, 8.679132, -0.030044], [1.244301, 10.219708, -1.013368], [1.596653, 10.219708, -0.162715], [-0.453452, 8.666538, -0.413299], [-0.943359, 10.698009, -0.796096], [-0.41535, 8.680934, 0.458149], [-1.124082, 10.240734, 1.305925], [-0.615087, 8.674124, 0.029312], [0.455572, 8.673882, 0.41419], [0.030262, 8.680454, 0.617428], [0.19826, 10.265886, 1.683316], [-1.047561, 9.850979, -1.242833], [-1.295711, 10.698009, 0.054557], [-1.033695, 10.221107, 0.955211], [-1.386047, 10.221107, 0.104558], [-0.273429, 10.240734, 1.658277], [1.048913, 10.265886, 1.330964], [1.372842, 10.188828, 0.072157], [1.02049, 10.188828, 0.922809], [-0.612894, 8.666538, -0.028373], [-0.455645, 8.674123, 0.414239], [0.415188, 8.680454, 0.457986], [0.615014, 8.673882, 0.029263], [-0.030423, 8.680934, 0.617592], [0, 7.002215, -0.64621], [0, 6.688767, -0.950214], [-0.671902, 6.688767, -0.671903], [-0.456939, 7.002215, -0.456939], [-0.950214, 6.688767, 0], [-0.64621, 7.002215, 0], [-0.671902, 6.688767, 0.671902], [-0.456939, 7.002215, 0.456939], [0, 6.688767, 0.950214], [0, 7.002215, 0.64621], [0.671903, 6.688767, 0.671902], [0.456939, 7.002215, 0.456939], [0.950214, 6.688767, 0], [0.64621, 7.002215, 0], [0.671903, 6.688767, -0.671902], [0.456939, 7.002215, -0.456939], [0, 5.897293, -0.990964], [0, 5.632519, -0.987739], [0, 5.76487, -0.955444], [-0.698437, 5.632519, -0.698437], [-0.700717, 5.897293, -0.700718], [-0.675601, 5.76487, -0.675601], [-0.987739, 5.632519, 0], [-0.990964, 5.897293, 0], [-0.955444, 5.76487, 0], [-0.698437, 5.632519, 0.698437], [-0.700717, 5.897293, 0.700717], [-0.675601, 5.76487, 0.675601], [0, 5.632519, 0.987739], [0, 5.897293, 0.990964], [0, 5.76487, 0.955444], [0.698437, 5.632519, 0.698437], [0.700718, 5.897293, 0.700717], [0.675601, 5.76487, 0.675601], [0.987739, 5.632519, 0], [0.990964, 5.897293, 0], [0.955444, 5.76487, 0], [0.698437, 5.632519, -0.698437], [0.700718, 5.897293, -0.700717], [0.675601, 5.76487, -0.675601], [0.878857, 4.262307, 0], [0.904866, 4.47734, 0], [0.858805, 4.369823, 0], [0.621446, 4.262307, 0.621445], [0.639837, 4.47734, 0.639837], [0.607267, 4.369823, 0.607266], [0, 4.262307, 0.878857], [0, 4.47734, 0.904866], [0, 4.369823, 0.858805], [-0.639837, 4.47734, 0.639837], [-0.621445, 4.262307, 0.621445], [-0.607266, 4.369823, 0.607266], [-0.878857, 4.262307, 0], [-0.904866, 4.47734, 0], [-0.858805, 4.369823, 0], [-0.639837, 4.47734, -0.639837], [-0.621445, 4.262307, -0.621446], [-0.607266, 4.369823, -0.607267], [0.639837, 4.47734, -0.639837], [0.621446, 4.262307, -0.621445], [0.607267, 4.369823, -0.607267], [0, 4.262307, -0.878857], [0, 4.47734, -0.904866], [0, 4.369823, -0.858805], [0.569605, 3.183155, 0.569605], [0.549208, 3.032002, 0.549207], [0.53725, 3.107392, 0.53725], [0.776697, 3.032002, 0], [0.805543, 3.183155, 0], [0.759786, 3.107392, 0], [0.569605, 3.183155, -0.569605], [0.549208, 3.032002, -0.549207], [0.53725, 3.107392, -0.53725], [0, 3.183155, -0.805543], [0, 3.032002, -0.776697], [0, 3.107392, -0.759786], [-0.549207, 3.032002, -0.549208], [-0.569605, 3.183155, -0.569605], [-0.53725, 3.107392, -0.53725], [-0.776697, 3.032002, 0], [-0.805543, 3.183155, 0], [-0.759786, 3.107392, 0], [-0.569605, 3.183155, 0.569605], [-0.549207, 3.032002, 0.549207], [-0.53725, 3.107392, 0.53725], [0, 3.032002, 0.776697], [0, 3.183155, 0.805543], [0, 3.107392, 0.759786], [0.595105, 1.563642, 0], [0.626144, 1.683317, 0], [0.591361, 1.623334, 0], [0.44275, 1.683317, 0.44275], [0.420803, 1.563642, 0.420802], [0.418156, 1.623334, 0.418155], [0, 1.563642, 0.595105], [0, 1.683317, 0.626144], [0, 1.623334, 0.591361], [0.420803, 1.563642, -0.420803], [0.44275, 1.683317, -0.44275], [0.418156, 1.623334, -0.418155], [0, 1.683317, -0.626144], [0, 1.563642, -0.595105], [0, 1.623334, -0.591361], [-0.420803, 1.563642, -0.420803], [-0.44275, 1.683317, -0.44275], [-0.418155, 1.623334, -0.418156], [-0.595105, 1.563642, 0], [-0.626144, 1.683317, 0], [-0.591361, 1.623334, 0], [-0.44275, 1.683317, 0.44275], [-0.420803, 1.563642, 0.420803], [-0.418155, 1.623334, 0.418155], [0, 0.469648, -0.37282], [0, 0.355653, -0.34729], [0, 0.412383, -0.336673], [-0.245571, 0.355653, -0.245571], [-0.263623, 0.469648, -0.263624], [-0.238064, 0.412383, -0.238064], [-0.34729, 0.355653, 0], [-0.37282, 0.469648, 0], [-0.336673, 0.412383, 0], [-0.245571, 0.355653, 0.245571], [-0.263623, 0.469648, 0.263623], [-0.238064, 0.412383, 0.238063], [0, 0.355653, 0.34729], [0, 0.469648, 0.37282], [0, 0.412383, 0.336673], [0.245571, 0.355653, 0.245571], [0.263624, 0.469648, 0.263623], [0.238064, 0.412383, 0.238063], [0.34729, 0.355653, 0], [0.37282, 0.469648, 0], [0.336673, 0.412383, 0], [0.245571, 0.355653, -0.245571], [0.263624, 0.469648, -0.263624], [0.238064, 0.412383, -0.238064]],
    [[105, 107, 0, [250, 100, 50]], [113, 98, 0, [250, 100, 50]], [111, 113, 0, [250, 100, 50]], [107, 109, 0, [250, 100, 50]], [103, 105, 0, [250, 100, 50]], [109, 111, 0, [250, 100, 50]], [135, 132, 139, [250, 100, 50]], [135, 139, 156, [250, 100, 50]], [126, 123, 147, [250, 100, 50]], [126, 147, 145, [250, 100, 50]], [120, 117, 153, [250, 100, 50]], [120, 153, 151, [250, 100, 50]], [183, 181, 207, [250, 100, 50]], [183, 207, 193, [250, 100, 50]], [129, 126, 145, [250, 100, 50]], [129, 145, 142, [250, 100, 50]], [123, 120, 151, [250, 100, 50]], [123, 151, 147, [250, 100, 50]], [118, 121, 102, [250, 100, 50]], [118, 102, 100, [250, 100, 50]], [101, 103, 0, [250, 100, 50]], [148, 150, 178, [250, 100, 50]], [148, 178, 180, [250, 100, 50]], [154, 159, 171, [250, 100, 50]], [154, 171, 175, [250, 100, 50]], [159, 157, 168, [250, 100, 50]], [159, 168, 171, [250, 100, 50]], [138, 141, 162, [250, 100, 50]], [138, 162, 166, [250, 100, 50]], [181, 177, 205, [250, 100, 50]], [181, 205, 207, [250, 100, 50]], [172, 169, 196, [250, 100, 50]], [172, 196, 198, [250, 100, 50]], [141, 144, 184, [250, 100, 50]], [141, 184, 162, [250, 100, 50]], [186, 190, 226, [250, 100, 50]], [186, 226, 229, [250, 100, 50]], [192, 208, 220, [250, 100, 50]], [192, 220, 223, [250, 100, 50]], [199, 195, 232, [250, 100, 50]], [199, 232, 210, [250, 100, 50]], [213, 211, 1, [250, 100, 50]], [195, 186, 229, [250, 100, 50]], [195, 229, 232, [250, 100, 50]], [190, 192, 223, [250, 100, 50]], [190, 223, 226, [250, 100, 50]], [208, 204, 217, [250, 100, 50]], [208, 217, 220, [250, 100, 50]], [130, 133, 110, [250, 100, 50]], [130, 110, 108, [250, 100, 50]], [115, 135, 156, [250, 100, 50]], [115, 156, 160, [250, 100, 50]], [121, 124, 104, [250, 100, 50]], [121, 104, 102, [250, 100, 50]], [127, 130, 108, [250, 100, 50]], [127, 108, 106, [250, 100, 50]], [133, 136, 112, [250, 100, 50]], [133, 112, 110, [250, 100, 50]], [117, 115, 160, [250, 100, 50]], [117, 160, 153, [250, 100, 50]], [136, 114, 99, [250, 100, 50]], [136, 99, 112, [250, 100, 50]], [124, 127, 106, [250, 100, 50]], [124, 106, 104, [250, 100, 50]], [101, 98, 99, [250, 100, 50]], [101, 99, 100, [250, 100, 50]], [103, 101, 100, [250, 100, 50]], [103, 100, 102, [250, 100, 50]], [105, 103, 102, [250, 100, 50]], [105, 102, 104, [250, 100, 50]], [107, 105, 104, [250, 100, 50]], [107, 104, 106, [250, 100, 50]], [109, 107, 106, [250, 100, 50]], [109, 106, 108, [250, 100, 50]], [111, 109, 108, [250, 100, 50]], [111, 108, 110, [250, 100, 50]], [113, 111, 110, [250, 100, 50]], [113, 110, 112, [250, 100, 50]], [98, 113, 112, [250, 100, 50]], [98, 112, 99, [250, 100, 50]], [98, 101, 0, [250, 100, 50]], [118, 114, 116, [250, 100, 50]], [118, 116, 119, [250, 100, 50]], [119, 116, 115, [250, 100, 50]], [119, 115, 117, [250, 100, 50]], [121, 118, 119, [250, 100, 50]], [121, 119, 122, [250, 100, 50]], [122, 119, 117, [250, 100, 50]], [122, 117, 120, [250, 100, 50]], [124, 121, 122, [250, 100, 50]], [124, 122, 125, [250, 100, 50]], [125, 122, 120, [250, 100, 50]], [125, 120, 123, [250, 100, 50]], [127, 124, 125, [250, 100, 50]], [127, 125, 128, [250, 100, 50]], [128, 125, 123, [250, 100, 50]], [128, 123, 126, [250, 100, 50]], [130, 127, 128, [250, 100, 50]], [130, 128, 131, [250, 100, 50]], [131, 128, 126, [250, 100, 50]], [131, 126, 129, [250, 100, 50]], [133, 130, 131, [250, 100, 50]], [133, 131, 134, [250, 100, 50]], [134, 131, 129, [250, 100, 50]], [134, 129, 132, [250, 100, 50]], [136, 133, 134, [250, 100, 50]], [136, 134, 137, [250, 100, 50]], [137, 134, 132, [250, 100, 50]], [137, 132, 135, [250, 100, 50]], [114, 136, 137, [250, 100, 50]], [114, 137, 116, [250, 100, 50]], [116, 137, 135, [250, 100, 50]], [116, 135, 115, [250, 100, 50]], [114, 118, 100, [250, 100, 50]], [114, 100, 99, [250, 100, 50]], [177, 174, 202, [250, 100, 50]], [177, 202, 205, [250, 100, 50]], [204, 201, 214, [250, 100, 50]], [204, 214, 217, [250, 100, 50]], [132, 129, 142, [250, 100, 50]], [132, 142, 139, [250, 100, 50]], [150, 154, 175, [250, 100, 50]], [150, 175, 178, [250, 100, 50]], [144, 148, 180, [250, 100, 50]], [144, 180, 184, [250, 100, 50]], [157, 138, 166, [250, 100, 50]], [157, 166, 168, [250, 100, 50]], [174, 172, 198, [250, 100, 50]], [174, 198, 202, [250, 100, 50]], [148, 144, 146, [250, 100, 50]], [148, 146, 149, [250, 100, 50]], [149, 146, 145, [250, 100, 50]], [149, 145, 147, [250, 100, 50]], [144, 141, 143, [250, 100, 50]], [144, 143, 146, [250, 100, 50]], [146, 143, 142, [250, 100, 50]], [146, 142, 145, [250, 100, 50]], [154, 150, 152, [250, 100, 50]], [154, 152, 155, [250, 100, 50]], [155, 152, 151, [250, 100, 50]], [155, 151, 153, [250, 100, 50]], [150, 148, 149, [250, 100, 50]], [150, 149, 152, [250, 100, 50]], [152, 149, 147, [250, 100, 50]], [152, 147, 151, [250, 100, 50]], [157, 159, 161, [250, 100, 50]], [157, 161, 158, [250, 100, 50]], [158, 161, 160, [250, 100, 50]], [158, 160, 156, [250, 100, 50]], [141, 138, 140, [250, 100, 50]], [141, 140, 143, [250, 100, 50]], [143, 140, 139, [250, 100, 50]], [143, 139, 142, [250, 100, 50]], [138, 157, 158, [250, 100, 50]], [138, 158, 140, [250, 100, 50]], [140, 158, 156, [250, 100, 50]], [140, 156, 139, [250, 100, 50]], [159, 154, 155, [250, 100, 50]], [159, 155, 161, [250, 100, 50]], [161, 155, 153, [250, 100, 50]], [161, 153, 160, [250, 100, 50]], [228, 225, 1, [250, 100, 50]], [172, 174, 176, [250, 100, 50]], [172, 176, 173, [250, 100, 50]], [173, 176, 175, [250, 100, 50]], [173, 175, 171, [250, 100, 50]], [169, 172, 173, [250, 100, 50]], [169, 173, 170, [250, 100, 50]], [170, 173, 171, [250, 100, 50]], [170, 171, 168, [250, 100, 50]], [163, 165, 167, [250, 100, 50]], [163, 167, 164, [250, 100, 50]], [164, 167, 166, [250, 100, 50]], [164, 166, 162, [250, 100, 50]], [181, 183, 185, [250, 100, 50]], [181, 185, 182, [250, 100, 50]], [182, 185, 184, [250, 100, 50]], [182, 184, 180, [250, 100, 50]], [174, 177, 179, [250, 100, 50]], [174, 179, 176, [250, 100, 50]], [176, 179, 178, [250, 100, 50]], [176, 178, 175, [250, 100, 50]], [165, 169, 170, [250, 100, 50]], [165, 170, 167, [250, 100, 50]], [167, 170, 168, [250, 100, 50]], [167, 168, 166, [250, 100, 50]], [183, 163, 164, [250, 100, 50]], [183, 164, 185, [250, 100, 50]], [185, 164, 162, [250, 100, 50]], [185, 162, 184, [250, 100, 50]], [177, 181, 182, [250, 100, 50]], [177, 182, 179, [250, 100, 50]], [179, 182, 180, [250, 100, 50]], [179, 180, 178, [250, 100, 50]], [169, 165, 187, [250, 100, 50]], [169, 187, 196, [250, 100, 50]], [231, 228, 1, [250, 100, 50]], [163, 183, 193, [250, 100, 50]], [163, 193, 189, [250, 100, 50]], [216, 213, 1, [250, 100, 50]], [222, 219, 1, [250, 100, 50]], [219, 216, 1, [250, 100, 50]], [211, 231, 1, [250, 100, 50]], [225, 222, 1, [250, 100, 50]], [190, 186, 188, [250, 100, 50]], [190, 188, 191, [250, 100, 50]], [191, 188, 187, [250, 100, 50]], [191, 187, 189, [250, 100, 50]], [186, 195, 197, [250, 100, 50]], [186, 197, 188, [250, 100, 50]], [188, 197, 196, [250, 100, 50]], [188, 196, 187, [250, 100, 50]], [199, 201, 203, [250, 100, 50]], [199, 203, 200, [250, 100, 50]], [200, 203, 202, [250, 100, 50]], [200, 202, 198, [250, 100, 50]], [208, 192, 194, [250, 100, 50]], [208, 194, 209, [250, 100, 50]], [209, 194, 193, [250, 100, 50]], [209, 193, 207, [250, 100, 50]], [201, 204, 206, [250, 100, 50]], [201, 206, 203, [250, 100, 50]], [203, 206, 205, [250, 100, 50]], [203, 205, 202, [250, 100, 50]], [195, 199, 200, [250, 100, 50]], [195, 200, 197, [250, 100, 50]], [197, 200, 198, [250, 100, 50]], [197, 198, 196, [250, 100, 50]], [204, 208, 209, [250, 100, 50]], [204, 209, 206, [250, 100, 50]], [206, 209, 207, [250, 100, 50]], [206, 207, 205, [250, 100, 50]], [192, 190, 191, [250, 100, 50]], [192, 191, 194, [250, 100, 50]], [194, 191, 189, [250, 100, 50]], [194, 189, 193, [250, 100, 50]], [165, 163, 189, [250, 100, 50]], [165, 189, 187, [250, 100, 50]], [214, 210, 212, [250, 100, 50]], [214, 212, 215, [250, 100, 50]], [215, 212, 211, [250, 100, 50]], [215, 211, 213, [250, 100, 50]], [217, 214, 215, [250, 100, 50]], [217, 215, 218, [250, 100, 50]], [218, 215, 213, [250, 100, 50]], [218, 213, 216, [250, 100, 50]], [220, 217, 218, [250, 100, 50]], [220, 218, 221, [250, 100, 50]], [221, 218, 216, [250, 100, 50]], [221, 216, 219, [250, 100, 50]], [223, 220, 221, [250, 100, 50]], [223, 221, 224, [250, 100, 50]], [224, 221, 219, [250, 100, 50]], [224, 219, 222, [250, 100, 50]], [226, 223, 224, [250, 100, 50]], [226, 224, 227, [250, 100, 50]], [227, 224, 222, [250, 100, 50]], [227, 222, 225, [250, 100, 50]], [229, 226, 227, [250, 100, 50]], [229, 227, 230, [250, 100, 50]], [230, 227, 225, [250, 100, 50]], [230, 225, 228, [250, 100, 50]], [232, 229, 230, [250, 100, 50]], [232, 230, 233, [250, 100, 50]], [233, 230, 228, [250, 100, 50]], [233, 228, 231, [250, 100, 50]], [210, 232, 233, [250, 100, 50]], [210, 233, 212, [250, 100, 50]], [212, 233, 231, [250, 100, 50]], [212, 231, 211, [250, 100, 50]], [201, 199, 210, [250, 100, 50]], [201, 210, 214, [250, 100, 50]], [37, 18, 25, [23, 180, 32]], [37, 25, 36, [23, 180, 32]], [49, 16, 23, [23, 180, 32]], [49, 23, 48, [23, 180, 32]], [45, 30, 21, [23, 180, 32]], [45, 21, 44, [23, 180, 32]], [41, 26, 19, [23, 180, 32]], [41, 19, 40, [23, 180, 32]], [15, 35, 34, [23, 180, 32]], [15, 34, 8, [23, 180, 32]], [35, 17, 24, [23, 180, 32]], [35, 24, 34, [23, 180, 32]], [47, 32, 22, [23, 180, 32]], [47, 22, 46, [23, 180, 32]], [43, 28, 20, [23, 180, 32]], [43, 20, 42, [23, 180, 32]], [33, 47, 46, [23, 180, 32]], [33, 46, 6, [23, 180, 32]], [2, 37, 36, [23, 180, 32]], [2, 36, 9, [23, 180, 32]], [27, 41, 40, [23, 180, 32]], [27, 40, 3, [23, 180, 32]], [31, 45, 44, [23, 180, 32]], [31, 44, 5, [23, 180, 32]], [14, 49, 48, [23, 180, 32]], [14, 48, 7, [23, 180, 32]], [10, 39, 38, [23, 180, 32]], [10, 38, 12, [23, 180, 32]], [29, 43, 42, [23, 180, 32]], [29, 42, 4, [23, 180, 32]], [39, 11, 13, [23, 180, 32]], [39, 13, 38, [23, 180, 32]], [69, 70, 72, [23, 180, 32]], [69, 72, 71, [23, 180, 32]], [96, 82, 92, [23, 180, 32]], [96, 92, 91, [23, 180, 32]], [97, 79, 80, [23, 180, 32]], [97, 80, 89, [23, 180, 32]], [93, 77, 78, [23, 180, 32]], [93, 78, 86, [23, 180, 32]], [62, 63, 74, [23, 180, 32]], [62, 74, 73, [23, 180, 32]], [73, 74, 76, [23, 180, 32]], [73, 76, 75, [23, 180, 32]], [95, 83, 84, [23, 180, 32]], [95, 84, 90, [23, 180, 32]], [94, 81, 88, [23, 180, 32]], [94, 88, 87, [23, 180, 32]], [58, 59, 83, [23, 180, 32]], [58, 83, 95, [23, 180, 32]], [64, 65, 70, [23, 180, 32]], [64, 70, 69, [23, 180, 32]], [52, 53, 77, [23, 180, 32]], [52, 77, 93, [23, 180, 32]], [56, 57, 79, [23, 180, 32]], [56, 79, 97, [23, 180, 32]], [60, 61, 82, [23, 180, 32]], [60, 82, 96, [23, 180, 32]], [50, 51, 68, [23, 180, 32]], [50, 68, 66, [23, 180, 32]], [54, 55, 81, [23, 180, 32]], [54, 81, 94, [23, 180, 32]], [66, 68, 67, [23, 180, 32]], [66, 67, 85, [23, 180, 32]], [25, 72, 70, [23, 180, 32]], [25, 70, 36, [23, 180, 32]], [45, 97, 89, [23, 180, 32]], [45, 89, 30, [23, 180, 32]], [28, 87, 88, [23, 180, 32]], [28, 88, 20, [23, 180, 32]], [23, 92, 82, [23, 180, 32]], [23, 82, 48, [23, 180, 32]], [12, 51, 50, [23, 180, 32]], [12, 50, 10, [23, 180, 32]], [30, 89, 80, [23, 180, 32]], [30, 80, 21, [23, 180, 32]], [14, 60, 96, [23, 180, 32]], [14, 96, 49, [23, 180, 32]], [35, 73, 75, [23, 180, 32]], [35, 75, 17, [23, 180, 32]], [40, 77, 53, [23, 180, 32]], [40, 53, 3, [23, 180, 32]], [3, 53, 52, [23, 180, 32]], [3, 52, 27, [23, 180, 32]], [32, 90, 84, [23, 180, 32]], [32, 84, 22, [23, 180, 32]], [34, 74, 63, [23, 180, 32]], [34, 63, 8, [23, 180, 32]], [41, 93, 86, [23, 180, 32]], [41, 86, 26, [23, 180, 32]], [4, 55, 54, [23, 180, 32]], [4, 54, 29, [23, 180, 32]], [16, 91, 92, [23, 180, 32]], [16, 92, 23, [23, 180, 32]], [24, 76, 74, [23, 180, 32]], [24, 74, 34, [23, 180, 32]], [5, 57, 56, [23, 180, 32]], [5, 56, 31, [23, 180, 32]], [17, 75, 76, [23, 180, 32]], [17, 76, 24, [23, 180, 32]], [36, 70, 65, [23, 180, 32]], [36, 65, 9, [23, 180, 32]], [20, 88, 81, [23, 180, 32]], [20, 81, 42, [23, 180, 32]], [6, 59, 58, [23, 180, 32]], [6, 58, 33, [23, 180, 32]], [18, 71, 72, [23, 180, 32]], [18, 72, 25, [23, 180, 32]], [19, 78, 77, [23, 180, 32]], [19, 77, 40, [23, 180, 32]], [29, 54, 94, [23, 180, 32]], [29, 94, 43, [23, 180, 32]], [7, 61, 60, [23, 180, 32]], [7, 60, 14, [23, 180, 32]], [27, 52, 93, [23, 180, 32]], [27, 93, 41, [23, 180, 32]], [2, 64, 69, [23, 180, 32]], [2, 69, 37, [23, 180, 32]], [8, 63, 62, [23, 180, 32]], [8, 62, 15, [23, 180, 32]], [43, 94, 87, [23, 180, 32]], [43, 87, 28, [23, 180, 32]], [21, 80, 79, [23, 180, 32]], [21, 79, 44, [23, 180, 32]], [44, 79, 57, [23, 180, 32]], [44, 57, 5, [23, 180, 32]], [9, 65, 64, [23, 180, 32]], [9, 64, 2, [23, 180, 32]], [38, 68, 51, [23, 180, 32]], [38, 51, 12, [23, 180, 32]], [42, 81, 55, [23, 180, 32]], [42, 55, 4, [23, 180, 32]], [31, 56, 97, [23, 180, 32]], [31, 97, 45, [23, 180, 32]], [10, 50, 66, [23, 180, 32]], [10, 66, 39, [23, 180, 32]], [39, 66, 85, [23, 180, 32]], [39, 85, 11, [23, 180, 32]], [48, 82, 61, [23, 180, 32]], [48, 61, 7, [23, 180, 32]], [13, 67, 68, [23, 180, 32]], [13, 68, 38, [23, 180, 32]], [15, 62, 73, [23, 180, 32]], [15, 73, 35, [23, 180, 32]], [22, 84, 83, [23, 180, 32]], [22, 83, 46, [23, 180, 32]], [46, 83, 59, [23, 180, 32]], [46, 59, 6, [23, 180, 32]], [33, 58, 95, [23, 180, 32]], [33, 95, 47, [23, 180, 32]], [11, 85, 67, [23, 180, 32]], [11, 67, 13, [23, 180, 32]], [47, 95, 90, [23, 180, 32]], [47, 90, 32, [23, 180, 32]], [37, 69, 71, [23, 180, 32]], [37, 71, 18, [23, 180, 32]], [49, 96, 91, [23, 180, 32]], [49, 91, 16, [23, 180, 32]], [26, 86, 78, [23, 180, 32]], [26, 78, 19, [23, 180, 32]]]]];
    var vectors=vectorsofobjects(objects);
    var pixelratio=50;

    // [cameraPosition,cameraVector,normal1,normal2]
    var cameraobject=[[0,5,-20],[0,0,20],[-1,0,0],[0,1,0]];

    var points=positionsoncamerasurface(objects,pixelratio,cameraobject);
    var objectchange=false;
    var camerachange=false;
    var drawingorder=[];

    var linepoints=[];
    for(var k=0;k<points.length;k++){
        linepoints.push(outline(points[k]));
    }
    var selectedobj=-1;
    var mousecontrol1=true;
    var mousecontrol2=true;
    var mousecontrol3=true;
    var mousecontrol4=false;

    function update(){
        if(window.innerWidth-20!=canvas_x){
            ctx.canvas.width=window.innerWidth-20;
            canvas_x=ctx.canvas.width;
            camerachange=true;
        }
        if(window.innerHeight-20!=canvas_y){
            ctx.canvas.height=window.innerHeight-20;
            canvas_y=ctx.canvas.height;
            camerachange=true;
        }
        ctx.beginPath();
        ctx.fillStyle="rgba(255,255,255)";
        ctx.fillRect(0,0,canvas_x,canvas_y);
        c.addEventListener("mousedown",function(event){
            if(event.button==0 && mousecontrol1){
                clickX=event.clientX;
                clickY=event.clientY;
                mousecontrol1=false;
                mousecontrol4=true;
            }
        },false);
        c.addEventListener("mousemove",function(event){
            if(event.button==0 && mousecontrol2 && mousecontrol4){
                var newclickX=event.clientX;
                var newclickY=event.clientY;
                var deltaX=newclickX-clickX;
                var deltaY=clickY-newclickY;
                clickX=newclickX;
                clickY=newclickY;
                if(deltaX!=0 || deltaY!=0){
                    var rotationvector=[cameraobject[2][0]*deltaY-cameraobject[3][0]*deltaX,cameraobject[2][1]*deltaY-cameraobject[3][1]*deltaX,cameraobject[2][2]*deltaY-cameraobject[3][2]*deltaX];
                    var deltalen=(deltaX**2+deltaY**2)**0.5;
                    var canvaslen=(canvas_x**2/4+canvas_y**2/4)**0.5;
                    cameraobject=generalrotation([0,5,0],cameraobject[0],rotationvector,cameraobject.slice(1,4),150*deltalen/canvaslen);
                    camerachange=true;
                }
                mousecontrol2=false;
            }
        },false);
        c.addEventListener("mouseup",function(event){
            if(event.button==0 && mousecontrol3){
                var dist=averageobjdistances(objects,cameraobject[0]);
                selectedobj=selectioncontrol(linepoints,clickX,clickY,dist);
                mousecontrol3=false;
                mousecontrol4=false;
            }
        },false);
        if(camerachange){
            linepoints=[];
            points=positionsoncamerasurface(objects,pixelratio,cameraobject);
            for(var k=0;k<points.length;k++){
                linepoints.push(outline(points[k]));
            }
            camerachange=false;
        }
        if(objectchange){
            vectors=vectorsofobjects(objects);
            objectchange=false;
        }
        drawingorder=priority(objects,cameraobject[0],vectors);
        for(var j=0;j<drawingorder.length;j++){
            var h=drawingorder[j][0];
            var k=drawingorder[j][1];
            if(points[h][objects[h][1][k][0]]!=false && points[h][objects[h][1][k][1]]!=false && points[h][objects[h][1][k][2]]!=false){
                ctx.beginPath();
                var drawingcolor=colorofmesh(objects[h][1][k][3],vectors[h][k][2],cameraobject[0],[(objects[h][0][objects[h][1][k][0]][0]+objects[h][0][objects[h][1][k][1]][0]+objects[h][0][objects[h][1][k][2]][0])/3,(objects[h][0][objects[h][1][k][0]][1]+objects[h][0][objects[h][1][k][1]][1]+objects[h][0][objects[h][1][k][2]][1])/3,(objects[h][0][objects[h][1][k][0]][2]+objects[h][0][objects[h][1][k][1]][2]+objects[h][0][objects[h][1][k][2]][2])/3]);
                ctx.fillStyle="rgba("+drawingcolor[0]+","+drawingcolor[1]+","+drawingcolor[2]+")";
                ctx.strokeStyle="rgba(0,0,0)";
                ctx.lineWidth=0.5;
                ctx.moveTo(points[h][objects[h][1][k][0]][0],points[h][objects[h][1][k][0]][1]);
                ctx.lineTo(points[h][objects[h][1][k][1]][0],points[h][objects[h][1][k][1]][1]);
                ctx.lineTo(points[h][objects[h][1][k][2]][0],points[h][objects[h][1][k][2]][1]);
                ctx.closePath();
                ctx.stroke();
                ctx.fill();
            }
            if(selectedobj==h && linepoints[selectedobj].length>0){
                ctx.beginPath();
                ctx.strokeStyle="rgba(255,0,0)";
                ctx.lineWidth=3;
                ctx.moveTo(linepoints[selectedobj][0][0],linepoints[selectedobj][0][1]);
                for(i=1;i<linepoints[selectedobj].length;i++){
                    ctx.lineTo(linepoints[selectedobj][i][0],linepoints[selectedobj][i][1]);
                }
                ctx.stroke();
            }
        }
        ctx.beginPath();
        ctx.strokeStyle="rgba(0,0,0)";
        ctx.lineWidth=10;
        ctx.rect(0,0,canvas_x,canvas_y);
        ctx.stroke();
        mousecontrol1=true;
        mousecontrol2=true;
        mousecontrol3=true;
    }
    setInterval(update,20);
</script>